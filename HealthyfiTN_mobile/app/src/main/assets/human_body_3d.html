<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar 3D Corps Humain</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #canvas3d {
            width: 100%;
            height: 100%;
            display: block;
        }

        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 350px;
            backdrop-filter: blur(10px);
        }

        #info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 300px;
            backdrop-filter: blur(10px);
            display: none;
        }

        h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-size: 13px;
            font-weight: 600;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .value-display {
            text-align: right;
            color: #666;
            font-size: 12px;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        .legend {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }

        #instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<body>
<div id="container">
    <canvas id="canvas3d"></canvas>

    <div id="controls">
        <h2>üè• Param√®tres Sant√©</h2>

        <div class="control-group">
            <label>‚ù§Ô∏è Fr√©quence Cardiaque (BPM)</label>
            <input type="range" id="heartRate" min="40" max="200" value="125">
            <div class="value-display"><span id="hrValue">125</span> bpm</div>
        </div>

        <div class="control-group">
            <label>ü´Å Oxyg√©nation (SpO‚ÇÇ)</label>
            <input type="range" id="oxygen" min="70" max="100" value="98">
            <div class="value-display"><span id="o2Value">98</span>%</div>
        </div>

        <div class="control-group">
            <label>üå°Ô∏è Temp√©rature (¬∞C)</label>
            <input type="range" id="temperature" min="35" max="42" value="38" step="0.1">
            <div class="value-display"><span id="tempValue">38.0</span>¬∞C</div>
        </div>

        <div class="control-group">
            <label>üß† Niveau de Stress</label>
            <input type="range" id="stress" min="0" max="100" value="80">
            <div class="value-display"><span id="stressValue">80</span>/100</div>
        </div>

        <div class="control-group">
            <label>üí™ Activit√© Musculaire</label>
            <input type="range" id="muscle" min="0" max="100" value="45">
            <div class="value-display"><span id="muscleValue">45</span>%</div>
        </div>

        <button onclick="resetToHealthData()">üìä Charger Donn√©es R√©elles</button>
        <button onclick="resetCamera()">üîÑ R√©initialiser Vue</button>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #4CAF50;"></div>
                <span>Normal / Excellent</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FFC107;"></div>
                <span>Attention / Mod√©r√©</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #F44336;"></div>
                <span>Critique / √âlev√©</span>
            </div>
        </div>
    </div>

    <div id="info">
        <h2 id="infoTitle">Zone S√©lectionn√©e</h2>
        <p id="infoContent">Cliquez sur une partie du corps pour voir les d√©tails</p>
    </div>

    <div id="instructions">
        üñ±Ô∏è Cliquer-Glisser: Rotation | üîç Molette: Zoom | üëÜ Cliquer: D√©tails
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    let scene, camera, renderer, humanBody;
    let heartMesh, brainMesh, lungsMesh, musclesMesh, stomachMesh;
    let mouseDown = false, mouseX = 0, mouseY = 0;
    let targetRotationX = 0, targetRotationY = 0;
    let currentRotationX = 0, currentRotationY = 0;
    let raycaster, mouse;

    // Donn√©es de sant√© par d√©faut (from your example)
    const healthData = {
        heartRate: 125,
        oxygen: 98,
        temperature: 38,
        stress: 80,
        muscle: 45
    };

    function init() {
        // Scene
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e);

        // Camera
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1, 5);
        camera.lookAt(0, 1, 0);

        // Renderer
        renderer = new THREE.WebGLRenderer({
            canvas: document.getElementById('canvas3d'),
            antialias: true
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;

        // Lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        const pointLight1 = new THREE.PointLight(0x667eea, 0.5);
        pointLight1.position.set(-3, 2, 2);
        scene.add(pointLight1);

        const pointLight2 = new THREE.PointLight(0x764ba2, 0.5);
        pointLight2.position.set(3, 2, 2);
        scene.add(pointLight2);

        // Raycaster for clicking
        raycaster = new THREE.Raycaster();
        mouse = new THREE.Vector2();

        // Create human body
        createHumanBody();

        // Event listeners
        setupEventListeners();

        // Animation loop
        animate();

        // Load initial health data
        updateHealthIndicators();
    }

    function createHumanBody() {
        humanBody = new THREE.Group();

        // Head
        const headGeometry = new THREE.SphereGeometry(0.25, 32, 32);
        const headMaterial = new THREE.MeshPhongMaterial({
            color: 0xffdbac,
            shininess: 30
        });
        const head = new THREE.Mesh(headGeometry, headMaterial);
        head.position.y = 2;
        head.castShadow = true;
        head.userData = { name: 'head', type: 'head' };
        humanBody.add(head);

        // Brain (inside head, visible through transparency)
        const brainGeometry = new THREE.SphereGeometry(0.18, 32, 32);
        const brainMaterial = new THREE.MeshPhongMaterial({
            color: 0xff69b4,
            emissive: 0xff1493,
            emissiveIntensity: 0.3,
            transparent: true,
            opacity: 0.8
        });
        brainMesh = new THREE.Mesh(brainGeometry, brainMaterial);
        brainMesh.position.copy(head.position);
        brainMesh.userData = { name: 'brain', type: 'organ' };
        humanBody.add(brainMesh);

        // Neck
        const neckGeometry = new THREE.CylinderGeometry(0.12, 0.12, 0.3, 16);
        const neckMaterial = new THREE.MeshPhongMaterial({ color: 0xffdbac });
        const neck = new THREE.Mesh(neckGeometry, neckMaterial);
        neck.position.y = 1.7;
        neck.castShadow = true;
        humanBody.add(neck);

        // Torso
        const torsoGeometry = new THREE.CylinderGeometry(0.35, 0.3, 0.9, 16);
        const torsoMaterial = new THREE.MeshPhongMaterial({ color: 0xffdbac });
        const torso = new THREE.Mesh(torsoGeometry, torsoMaterial);
        torso.position.y = 1.1;
        torso.castShadow = true;
        torso.userData = { name: 'torso', type: 'torso' };
        humanBody.add(torso);

        // Heart (visible, pulsing)
        const heartGeometry = new THREE.SphereGeometry(0.12, 32, 32);
        const heartMaterial = new THREE.MeshPhongMaterial({
            color: 0xff0000,
            emissive: 0xff0000,
            emissiveIntensity: 0.5,
            transparent: true,
            opacity: 0.9
        });
        heartMesh = new THREE.Mesh(heartGeometry, heartMaterial);
        heartMesh.position.set(-0.1, 1.2, 0.35);
        heartMesh.userData = { name: 'heart', type: 'organ' };
        humanBody.add(heartMesh);

        // Lungs
        const lungGeometry = new THREE.SphereGeometry(0.15, 16, 16);
        const lungMaterial = new THREE.MeshPhongMaterial({
            color: 0xff69b4,
            emissive: 0xff1493,
            emissiveIntensity: 0.2,
            transparent: true,
            opacity: 0.7
        });

        const leftLung = new THREE.Mesh(lungGeometry, lungMaterial);
        leftLung.position.set(0.2, 1.2, 0.25);
        leftLung.scale.set(0.8, 1.2, 0.6);
        leftLung.userData = { name: 'leftLung', type: 'organ' };
        humanBody.add(leftLung);

        const rightLung = new THREE.Mesh(lungGeometry, lungMaterial.clone());
        rightLung.position.set(-0.25, 1.2, 0.25);
        rightLung.scale.set(0.8, 1.2, 0.6);
        rightLung.userData = { name: 'rightLung', type: 'organ' };
        humanBody.add(rightLung);

        lungsMesh = new THREE.Group();
        lungsMesh.add(leftLung);
        lungsMesh.add(rightLung);

        // Stomach
        const stomachGeometry = new THREE.SphereGeometry(0.15, 16, 16);
        const stomachMaterial = new THREE.MeshPhongMaterial({
            color: 0xffa500,
            emissive: 0xff8c00,
            emissiveIntensity: 0.2,
            transparent: true,
            opacity: 0.7
        });
        stomachMesh = new THREE.Mesh(stomachGeometry, stomachMaterial);
        stomachMesh.position.set(0, 0.85, 0.25);
        stomachMesh.scale.set(1, 0.8, 0.8);
        stomachMesh.userData = { name: 'stomach', type: 'organ' };
        humanBody.add(stomachMesh);

        // Arms
        const armGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.8, 16);
        const armMaterial = new THREE.MeshPhongMaterial({ color: 0xffdbac });

        const leftArm = new THREE.Mesh(armGeometry, armMaterial);
        leftArm.position.set(0.45, 1.1, 0);
        leftArm.rotation.z = 0.3;
        leftArm.castShadow = true;
        humanBody.add(leftArm);

        const rightArm = new THREE.Mesh(armGeometry, armMaterial);
        rightArm.position.set(-0.45, 1.1, 0);
        rightArm.rotation.z = -0.3;
        rightArm.castShadow = true;
        humanBody.add(rightArm);

        // Muscles (biceps)
        const muscleGeometry = new THREE.SphereGeometry(0.1, 16, 16);
        const muscleMaterial = new THREE.MeshPhongMaterial({
            color: 0xff6b6b,
            emissive: 0xff0000,
            emissiveIntensity: 0.2
        });

        const leftMuscle = new THREE.Mesh(muscleGeometry, muscleMaterial);
        leftMuscle.position.set(0.45, 1.3, 0);
        leftMuscle.scale.set(1.2, 0.8, 0.8);
        leftMuscle.userData = { name: 'leftMuscle', type: 'muscle' };
        humanBody.add(leftMuscle);

        const rightMuscle = new THREE.Mesh(muscleGeometry, muscleMaterial.clone());
        rightMuscle.position.set(-0.45, 1.3, 0);
        rightMuscle.scale.set(1.2, 0.8, 0.8);
        rightMuscle.userData = { name: 'rightMuscle', type: 'muscle' };
        humanBody.add(rightMuscle);

        musclesMesh = new THREE.Group();
        musclesMesh.add(leftMuscle);
        musclesMesh.add(rightMuscle);

        // Pelvis
        const pelvisGeometry = new THREE.CylinderGeometry(0.3, 0.35, 0.3, 16);
        const pelvisMaterial = new THREE.MeshPhongMaterial({ color: 0xffdbac });
        const pelvis = new THREE.Mesh(pelvisGeometry, pelvisMaterial);
        pelvis.position.y = 0.5;
        pelvis.castShadow = true;
        humanBody.add(pelvis);

        // Legs
        const legGeometry = new THREE.CylinderGeometry(0.1, 0.09, 1, 16);
        const legMaterial = new THREE.MeshPhongMaterial({ color: 0xffdbac });

        const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
        leftLeg.position.set(0.15, 0, 0);
        leftLeg.castShadow = true;
        humanBody.add(leftLeg);

        const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
        rightLeg.position.set(-0.15, 0, 0);
        rightLeg.castShadow = true;
        humanBody.add(rightLeg);

        humanBody.position.y = 0.5;
        scene.add(humanBody);
    }

    function updateHealthIndicators() {
        // Heart Rate (color based on BPM)
        const hr = parseInt(document.getElementById('heartRate').value);
        document.getElementById('hrValue').textContent = hr;
        healthData.heartRate = hr;

        let heartColor;
        if (hr < 60 || hr > 100) {
            heartColor = 0xff0000; // Red - abnormal
        } else if (hr > 90) {
            heartColor = 0xffa500; // Orange - elevated
        } else {
            heartColor = 0xff69b4; // Pink - normal
        }
        heartMesh.material.color.setHex(heartColor);
        heartMesh.material.emissive.setHex(heartColor);

        // Oxygen (lungs color)
        const o2 = parseInt(document.getElementById('oxygen').value);
        document.getElementById('o2Value').textContent = o2;
        healthData.oxygen = o2;

        let lungColor;
        if (o2 < 90) {
            lungColor = 0xff0000; // Red - critical
        } else if (o2 < 95) {
            lungColor = 0xffa500; // Orange - low
        } else {
            lungColor = 0x87ceeb; // Sky blue - normal
        }
        lungsMesh.children.forEach(lung => {
            lung.material.color.setHex(lungColor);
            lung.material.emissive.setHex(lungColor);
        });

        // Temperature (brain/head color)
        const temp = parseFloat(document.getElementById('temperature').value);
        document.getElementById('tempValue').textContent = temp.toFixed(1);
        healthData.temperature = temp;

        let brainColor;
        if (temp > 38 || temp < 36) {
            brainColor = 0xff0000; // Red - fever/hypothermia
        } else if (temp > 37.5) {
            brainColor = 0xffa500; // Orange - slightly elevated
        } else {
            brainColor = 0xff69b4; // Pink - normal
        }
        brainMesh.material.color.setHex(brainColor);
        brainMesh.material.emissive.setHex(brainColor);

        // Stress (overall body glow)
        const stress = parseInt(document.getElementById('stress').value);
        document.getElementById('stressValue').textContent = stress;
        healthData.stress = stress;

        // Muscle activity
        const muscle = parseInt(document.getElementById('muscle').value);
        document.getElementById('muscleValue').textContent = muscle;
        healthData.muscle = muscle;

        let muscleColor = new THREE.Color();
        muscleColor.setHSL(0, muscle / 100, 0.5);
        musclesMesh.children.forEach(m => {
            m.material.color.copy(muscleColor);
            m.material.emissive.copy(muscleColor);
            m.material.emissiveIntensity = muscle / 200;
        });
    }

    function setupEventListeners() {
        // Sliders
        document.getElementById('heartRate').addEventListener('input', updateHealthIndicators);
        document.getElementById('oxygen').addEventListener('input', updateHealthIndicators);
        document.getElementById('temperature').addEventListener('input', updateHealthIndicators);
        document.getElementById('stress').addEventListener('input', updateHealthIndicators);
        document.getElementById('muscle').addEventListener('input', updateHealthIndicators);

        // Mouse controls for rotation
        renderer.domElement.addEventListener('mousedown', onMouseDown);
        renderer.domElement.addEventListener('mousemove', onMouseMove);
        renderer.domElement.addEventListener('mouseup', onMouseUp);
        renderer.domElement.addEventListener('wheel', onWheel);

        // Click for details
        renderer.domElement.addEventListener('click', onBodyClick);

        // Window resize
        window.addEventListener('resize', onWindowResize);
    }

    function onMouseDown(event) {
        mouseDown = true;
        mouseX = event.clientX;
        mouseY = event.clientY;
    }

    function onMouseMove(event) {
        if (!mouseDown) return;

        const deltaX = event.clientX - mouseX;
        const deltaY = event.clientY - mouseY;

        targetRotationY += deltaX * 0.01;
        targetRotationX += deltaY * 0.01;

        targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotationX));

        mouseX = event.clientX;
        mouseY = event.clientY;
    }

    function onMouseUp() {
        mouseDown = false;
    }

    function onWheel(event) {
        event.preventDefault();
        camera.position.z += event.deltaY * 0.005;
        camera.position.z = Math.max(2, Math.min(10, camera.position.z));
    }

    function onBodyClick(event) {
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(humanBody.children, true);

        if (intersects.length > 0) {
            const object = intersects[0].object;
            showBodyPartInfo(object);
        }
    }

    function showBodyPartInfo(object) {
        const infoDiv = document.getElementById('info');
        const infoTitle = document.getElementById('infoTitle');
        const infoContent = document.getElementById('infoContent');

        const userData = object.userData;
        let title = '';
        let content = '';

        switch(userData.name) {
            case 'heart':
                title = '‚ù§Ô∏è C≈ìur';
                content = `Fr√©quence: ${healthData.heartRate} BPM<br>
                           √âtat: ${healthData.heartRate > 100 ? '√âlev√©' : healthData.heartRate < 60 ? 'Bas' : 'Normal'}<br>
                           Variabilit√©: Bonne`;
                break;
            case 'brain':
                title = 'üß† Cerveau';
                content = `Temp√©rature: ${healthData.temperature}¬∞C<br>
                           Stress: ${healthData.stress}/100<br>
                           Activit√©: ${healthData.stress > 60 ? '√âlev√©e' : 'Normale'}`;
                break;
            case 'leftLung':
            case 'rightLung':
                title = 'ü´Å Poumons';
                content = `SpO‚ÇÇ: ${healthData.oxygen}%<br>
                           √âtat: ${healthData.oxygen < 95 ? 'Attention' : 'Excellent'}<br>
                           Capacit√©: Normale`;
                break;
            case 'stomach':
                title = 'üçΩÔ∏è Estomac';
                content = `Hydratation: 0.40 L<br>
                           Digestion: Normale<br>
                           Derni√®re mesure: 11:51`;
                break;
            case 'leftMuscle':
            case 'rightMuscle':
                title = 'üí™ Muscles';
                content = `Activit√©: ${healthData.muscle}%<br>
                           Fatigue: ${100 - healthData.muscle}%<br>
                           Pas aujourd'hui: 231`;
                break;
            default:
                title = 'üë§ Corps Humain';
                content = 'Cliquez sur les zones color√©es pour plus de d√©tails';
        }

        infoTitle.textContent = title;
        infoContent.innerHTML = content;
        infoDiv.style.display = 'block';

        setTimeout(() => {
            infoDiv.style.display = 'none';
        }, 5000);
    }

    function resetToHealthData() {
        document.getElementById('heartRate').value = 125;
        document.getElementById('oxygen').value = 98;
        document.getElementById('temperature').value = 38;
        document.getElementById('stress').value = 80;
        document.getElementById('muscle').value = 45;
        updateHealthIndicators();
    }

    function resetCamera() {
        camera.position.set(0, 1, 5);
        camera.lookAt(0, 1, 0);
        targetRotationX = 0;
        targetRotationY = 0;
        currentRotationX = 0;
        currentRotationY = 0;
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        requestAnimationFrame(animate);

        // Smooth rotation
        currentRotationX += (targetRotationX - currentRotationX) * 0.1;
        currentRotationY += (targetRotationY - currentRotationY) * 0.1;

        humanBody.rotation.y = currentRotationY;
        humanBody.rotation.x = currentRotationX;

        // Heart pulse animation
        const pulse = Math.sin(Date.now() * 0.008) * 0.05 + 1;
        heartMesh.scale.set(pulse, pulse, pulse);

        // Breathing animation for lungs
        const breath = Math.sin(Date.now() * 0.002) * 0.03 + 1;
        lungsMesh.children.forEach(lung => {
            lung.scale.y = 1.2 * breath;
        });

        renderer.render(scene, camera);
    }

    // Initialize
    init();
</script>
</body>
</html>